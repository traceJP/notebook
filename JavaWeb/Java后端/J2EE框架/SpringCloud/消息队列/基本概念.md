# 一、消息队列中间件

## 1、概念

- 消息中间件是基于队列与消息传递技术，在网络环境中为应用系统提供同步或异步、可靠的消息传输的支撑性软件系统。并且利用高效可靠的消息传递机制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。通过提供消息传递和消息排队模型，它可以在分布式环境下扩展进程间的通信。
- 通过提供消息传递、消息排队模型在分布式环境下提供应用解耦、弹性伸缩、冗余存储、流量削峰、异步通信、数据同步等功能。

## 2、分布式系统缺点

- 在传统的分布式系统调用中，通常采用restTemplate等直接http调用，这种调用方式当请求数一多，则会造成后面的请求将持续同步堵塞，直到轮到自己的服务调用。
- 解决方案：将请求改为异步处理，直接发送一个消息后就无需再关心请求的问题即可。并且消费者接收消息按队列形式整理请求一个一个完成。

## 3、架构

- 发送者把消息发送给消息服务器，消息服务器将消息存放在若干队列/主题中，在合适的时候，消息服务器会将消息转发给接受者。在这个过程中，发送和接受是异步的，也就是发送无需等待，而且发送者和接受者的生命周期也没有必然关系。
- 尤其在发布（pub）、订阅（sub）模式下，也可以完成一对多的通信，即让一个消息有多个接受者。

 

![clipboard.png](%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/clip_image002.gif)

- 架构实例：
    - 原本架构：订单系统（假设完成请求只需要1秒）直接调用仓储系统（假设完成请求需要10秒），同步方式进行，订单系统将等待仓储系统响应后才可以继续工作（即需要等待10秒才能响应）。
    - 引入MQ：订单系统直接发送消息后即可继续工作（无需等待，1秒就返回），返回响应。而仓储系统通过MQ接收消息完成请求。

![clipboard.png](%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.assets/clip_image004.gif)

 

# 二、技术选型

## 1、主流常见MQ

- Kafka、RabbitMQ、RocketMQ、ActiveMQ（基于jms规范）

## 2、MQ特征

- api发送和接收、MQ高可用性、MQ集群和容错配置、MQ持久化（类似redis-rdb\aof）、延时发送\定时投递、签收机制、spring整合

 

 